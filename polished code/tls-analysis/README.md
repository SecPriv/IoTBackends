# Directory Structure and File Order of Execution

The following folder contains all the scripts for the TLS assessment of MQTT and XMPP backends and the evaluation of the results. We exclude CoAP from the analysis as it is based on UDP.

1. [check_shodan_endpoints.py](check_shodan_endpoints.py) takes as input the start and end of the batch of Shodan backends, the JSON file containing all the backends, and the output directory for the scanning results. The script tests via testssl for supported TLS versions and ciphers, known vulnerabilities and certificate validity (e.g., expiration dates, revocation lists, etc.). A folder for each backend is created and contains a text file.
2. [parse_results.py](parse_results.py) iterates over all the backends' directories and parses the results, extracting for each backend the supported versions, the ciphers, etc. It takes the protocol, i.e., `mqtt` or `xmpp`, as input. It outputs a JSON file with all parsed results. For a more compact version of the results (e.g., only showing how many backends are adopting TLSv1, or are affected by BEAST), run [summarize_results.py](summarize_results.py) on the output of the previous script. The latter script takes again as input the protocol to summarize.
3. [get_num_certs_and_old_TLS_num_protocol.py](get_num_certs_and_old_TLS_num_protocol.py) gets two statistics out of the results of the [parse_results.py](parse_results.py) script. It gets the number of backends adopting an older TLS version (in this case, $<v1.1$) and the number of certificates we can collect. It takes the protocol, i.e., `mqtt` or `xmpp`, as input.
4. [check_revocation_list_status.py](check_revocation_list_status.py) check if each of the collected certificates (contained in the output of [parse_results.py](parse_results.py)) is included in any Certificate Revocation Lists (CRLs). To do so, it downloads the list and checks whether the certificate's serial is included. It takes the protocol and the output folder as input. 
5. [get_common_name_matches.py](get_common_name_matches.py) iterates over all the backend results and extracts the Common Names (CN) contained in the certificates and the backend domain name. It checks whether there is a match or not between them. The script takes the protocol to analyze as input.
